console.log("store",window.localStorage.getItem("user-config")),window.localStorage.getItem("user-config")||window.localStorage.setItem("user-config",JSON.stringify({auto_update:!1}));var storeData={previousIndex:0,spin_system_index:0,method_index:0,data:{name:"",description:[],spin_systems:[],methods:[]}};function ctxTriggerID(){return dash_clientside.callback_context.triggered.map(t=>t.prop_id)}function ctxTriggerStates(){return dash_clientside.callback_context.states}function checkForEmptyListBeforeOperation(operation,list,l){if(0===l)throw alert(`Cannot ${operation} ${list} from an empty list. Try adding a ${list} first.`),window.dash_clientside.PreventUpdate}function scrollTo(element,to,duration,direction){var start,change,currentTime,increment,animateScroll;"vertical"===direction&&(start=element.scrollTop,change=to-start,currentTime=0,increment=20,(animateScroll=function(){currentTime+=increment;var val=Math.easeInOutQuad(currentTime,start,change,duration);element.scrollTop=val,currentTime<duration&&setTimeout(animateScroll,increment)})()),"horizontal"===direction&&(start=element.scrollLeft,change=to-start,currentTime=0,increment=20,(animateScroll=function(){currentTime+=increment;var val=Math.easeInOutQuad(currentTime,start,change,duration);element.scrollLeft=val,currentTime<duration&&setTimeout(animateScroll,increment)})())}window.dash_clientside||(window.dash_clientside={}),window.dash_clientside.clientside={initialize:function(n){return window.sessionStorage&&window.sessionStorage.clear(),init(),activateMethodTools(),activateSystemTools(),null},onReload:function(data){storeData.data=data,_onSpinSystemsLoad(),_onMethodsLoad()},downloadSession:function(dataStr,data){if(null===dataStr)throw window.dash_clientside.PreventUpdate;if(null===data)throw window.dash_clientside.PreventUpdate;dataStr="data:text/json;charset=utf-8,";dataStr+=encodeURIComponent(JSON.stringify(data));let dlAnchorElem=document.getElementById("download-session-link");return dlAnchorElem.setAttribute("href",dataStr),dlAnchorElem.setAttribute("download","session.mrsim"),dlAnchorElem.click(),dataStr=ndlAnchorElem=null,""}},Math.easeInOutQuad=function(t,b,c,d){return(t/=d/2)<1?c/2*t*t+b:-c/2*(--t*(t-2)-1)+b};var contextMenu=function(){return`<nav class="context-menu">
        <ul class="context-menu__items">
        <li class="context-menu__item">
            <a href="#" class="context-menu__link">
            <i class="fa fa-eye"></i> View Task
            </a>
        </li>
        <li class="context-menu__item">
            <a href="#" class="context-menu__link">
            <i class="fa fa-edit"></i> Edit Task
            </a>
        </li>
        <li class="context-menu__item">
            <a href="#" class="context-menu__link">
            <i class="fa fa-times"></i> Delete Task
            </a>
        </li>
        </ul>
    </nav>`},darkMode=function(){let element=document.body;element.classList.toggle("dark-mode")},spin_system_icon={prefix:"fac",iconName:"spin-systems",icon:[70,70,[],null,"M72.3,47.8c0,7.7-6.3,14-14,14s-14-6.3-14-14s6.3-14,14-14S72.3,40.1,72.3,47.8z M25.2,34.1c-3.5,0-6.3,2.8-6.3,6.3 s2.8,6.3,6.3,6.3s6.3-2.8,6.3-6.3S28.7,34.1,25.2,34.1z M8.2,10.8C3.7,10.8,0,14.4,0,19s3.7,8.2,8.2,8.2s8.2-3.7,8.2-8.2 S12.7,10.8,8.2,10.8z M43.2,0c-6.4,0-11.7,5.2-11.7,11.7s5.2,11.7,11.7,11.7s11.7-5.2,11.7-11.7S49.6,0,43.2,0z M29.7,34.7 c0.4,0.8,8.2-15.3,8.1-15.4c0-0.2-0.3-0.3-0.5-0.2c-0.2,0.1-11,14.4-10.4,14.3C27.5,33.3,29.3,34,29.7,34.7z M17.4,18.6 c0.4,0,15.2-6.2,15.3-6.3s0-0.5-0.2-0.6c-0.2-0.1-16.3,2.9-16,3.2C17.1,15.4,17.7,18.2,17.4,18.6z M53.7,33.2c0.7-0.2,0.3-0.8,0-1.4 C52.2,28.5,47.1,18,47,17.9c-0.2-0.1-0.5,0-0.7,0.2c-0.1,0.2,3.9,15.5,4.3,16C50.9,34.6,52.6,33.6,53.7,33.2z"]};FontAwesome.library.add(spin_system_icon);var decompose_icon={prefix:"fac",iconName:"decompose",icon:[70,70,[],null,"M7.7,57.6C11,40.8,14.3,24,17.7,7.2C23.7,18.1,29.8,29,35.9,39.9C26.5,45.8,17.1,51.7,7.7,57.6z M73,63L50.3,0.8 c-3.6,14.3-7.2,28.6-10.8,42.9C29.3,50.1,19.1,56.6,8.8,63C30.2,63,51.6,63,73,63z M0,72.8h74.6v-5.1H5.1V0H0V72.8z"]};FontAwesome.library.add(decompose_icon);var compose_icon={prefix:"fac",iconName:"compose",icon:[70,70,[],null,"M5.1,0v67.7h69.5v5.1H0V0 M71.5,61C64.1,41.5,53.8,2.3,49.2,2.3s-7.9,40.5-10.6,40.5C36,42.7,20.7,7.4,17.3,8.3S8.6,61,8.6,61"]};FontAwesome.library.add(compose_icon);var spectrum_icon={prefix:"fac",iconName:"spectrum",icon:[70,70,[],null,"M9,62.9C14.6,17.4,19.4,7.3,22.9,7.3C30.1,7.2,35.1,51.1,45.2,51c5.8-0.1,8.4-14.7,13.6-14.3c5,0.3,8.2,14.1,10.2,26.3 M0,0 v72.2h72v-5.1H5.1V0"]};FontAwesome.library.add(spectrum_icon);var init=function(){let element=document.getElementById("spin-system-name");return element.addEventListener("keyup",event=>{document.getElementById("spin-system-title").innerHTML=getValue("spin-system-name"),event.preventDefault()}),element=document.getElementById("search-method"),element.addEventListener("input",searchMethods),null},hideQuad=function(){let isotope_id,quad_collapse;isotope_id=getValue("isotope"),quad_collapse=document.getElementById("quadrupolar-feature-collapse"),!ISOTOPE_DATA.includes(isotope_id)?quad_collapse.classList.add("show"):quad_collapse.classList.remove("show")},activateMethodTools=function(){const obj=document.querySelectorAll("[data-table-header-mth] li");obj.forEach((li,i)=>{li.addEventListener("click",()=>{0==i&&document.getElementById("add-method-button").click(),1==i&&document.getElementById("duplicate-method-button").click(),2==i&&document.getElementById("remove-method-button").click()})})},updateMethod=function(){let result={};return result.data=window.method.updateFields(),result.index=window.method.getIndex(),result.operation="modify",result},addMethod=function(method_template,l){let result={};return result.data=method_template.method,result.index=l,result.operation="add",result.time=Date.now(),method_template=l=null,result},copyMethod=function(data,l){let result={};return checkForEmptyListBeforeOperation("copy","method",l),result.data=data.methods[window.method.getIndex()],result.index=l,result.operation="duplicate",data=l=null,result},delMethod=function(l){let result={};checkForEmptyListBeforeOperation("delete","method",l);var new_val=window.method.getIndex();return result.data=Date.now(),result.index=new_val,result.operation="delete",n4=l=null,result},_updateMethodJson=function(){var trig_id=ctxTriggerID()[0].split(".")[0].split("-")[0],method_template=ctxTriggerStates()["add-method-from-template.data"],data=storeData.data,l=data.methods.length;return"apply"===trig_id?updateMethod():"add"===trig_id?addMethod(method_template,l):"duplicate"===trig_id?copyMethod(data,l):"remove"===trig_id?delMethod(l):null},_onMethodsLoad=function(){var listomers=document.querySelectorAll("#method-read-only div.scrollable-list ul li");activatePencilButton(document.querySelectorAll("[data-edit-mth]"),"view-methods"),activateHomeTableElements(document.querySelectorAll("[data-table-mth] thead"),listomers),toggleClassNamesForSmallerScreens(document.getElementById("met-slide"),listomers.length),updateListEventListener(listomers,window.method.onClick);let index=window.method.getIndex();return index=index>=listomers.length?0:index,window.method.select(listomers,index),null},_setFields=function(index){let method=storeData.data.methods[index],sd,i,temp;if(document.getElementById("method-title").innerHTML=method.name,null!=method.experiment){let application=method.experiment.csdm.dependent_variables[0].application;null==application&&(application={}),null==application["com.github.DeepanshS.mrsimulator"]&&(application["com.github.DeepanshS.mrsimulator"]={sigma:1});let sigma=application["com.github.DeepanshS.mrsimulator"].sigma;1!=document.getElementById("measurement-sigma").value&&(sigma=document.getElementById("measurement-sigma").value),setValue("measurement-sigma",sigma)}for(temp=parseQuantityValue(method.magnetic_flux_density),setValue("magnetic_flux_density",temp),temp=parseQuantityValue(method.rotor_frequency)/1e3,setValue("rotor_frequency",temp),temp=rad_to_deg(parseQuantityValue(method.rotor_angle)),setValue("rotor_angle",temp),i=0;i<method.spectral_dimensions.length;i++)sd=method.spectral_dimensions[i],setValue(`count-${i}`,sd.count),temp=parseQuantityValue(sd.spectral_width)/1e3,setValue(`spectral_width-${i}`,temp),temp=parseQuantityValue(sd.reference_offset)/1e3,setValue(`reference_offset-${i}`,temp),setValue(`label-${i}`,sd.label);let dimUI,n_dim=method.spectral_dimensions.length;for(i=0;i<2;i++)dimUI=document.getElementById(`dim-${i}-feature-collapse`),i<n_dim?dimUI.classList.add("show"):dimUI.classList.remove("show");method=sd=null};window.dash_clientside.method={updateMethodJson:_updateMethodJson,onMethodsLoad:_onMethodsLoad,export_simulation_from_selected_method:function(dataStr,data){if(null===dataStr)return alert("No method found. Try adding a method first."),"";if(null===data)return alert("No simulation data available for the method."),"";dataStr="data:text/json;charset=utf-8,";dataStr+=encodeURIComponent(JSON.stringify(data));let dlAnchorElem=document.getElementById("export-simulation-from-method-link");return dlAnchorElem.setAttribute("href",dataStr),dlAnchorElem.setAttribute("download","simulation.csdf"),dlAnchorElem.click(),dataStr=ndlAnchorElem=null,""}};var decodeFromBase64=function(buffer){let binary_string=atob(buffer);buffer=new ArrayBuffer(binary_string.length);let bytes_buffer=new Uint8Array(buffer);for(let i=0;i<binary_string.length;i++)bytes_buffer[i]=binary_string.charCodeAt(i);return new Float64Array(buffer)};function searchMethods(){let input,filter,li,i,j,elements1,elements2,elements,txtValue;for(input=document.getElementById("search-method"),filter=input.value.toUpperCase(),li=document.querySelectorAll("#method-read-only div.scrollable-list ul li"),i=0;i<li.length;i++)for(elements1=li[i].getElementsByTagName("div"),elements2=li[i].getElementsByTagName("b"),elements=[...elements1,...elements2],j=0;j<elements.length;j++){if(txtValue=elements[j].textContent||elements[j].innerText,-1<txtValue.toUpperCase().indexOf(filter)){li[i].style.display="";break}li[i].style.display="none"}input=filter=li=i=j=elements1=elements2=elements=txtValue=null}window.method||(window.method={}),window.method={getIndex:function(){return storeData.method_index},setIndex:function(index){storeData.method_index=index},select:function(listomers,index){0<listomers.length&&listomers[index].click()},onClick:function(index){window.method.setIndex(index),window.method.setFields(index);let overView=document.querySelectorAll("[data-table-mth] thead");overView.forEach(tr=>{tr.classList.remove("active")}),overView[index+1].classList.add("active")},setFields:_setFields,updateFields:function(){let sd,i,temp,method=storeData.data.methods[window.method.getIndex()];if(null!=method.experiment){temp=getValue("measurement-sigma");let application=method.experiment.csdm.dependent_variables[0].application;null==application&&(application={}),null==application["com.github.DeepanshS.mrsimulator"]&&(application["com.github.DeepanshS.mrsimulator"]={}),application["com.github.DeepanshS.mrsimulator"].sigma=temp}for(temp=getValue("magnetic_flux_density"),method.magnetic_flux_density=toQuantityValue(temp,"T"),temp=deg_to_rad(getValue("rotor_angle")),method.rotor_angle=toQuantityValue(temp,"rad"),temp=1e3*getValue("rotor_frequency"),method.rotor_frequency=toQuantityValue(temp,"Hz"),i=0;i<method.spectral_dimensions.length;i++)sd=method.spectral_dimensions[i],sd.count=getValue(`count-${i}`),temp=1e3*getValue(`spectral_width-${i}`),sd.spectral_width=toQuantityValue(temp,"Hz"),temp=1e3*getValue(`reference_offset-${i}`),sd.reference_offset=toQuantityValue(temp,"Hz");return sd=i=null,method}};const ISOTOPE_DATA=["1H","3He","13C","15N","19F","29Si","31P","57Fe","77Se","89Y","103Rh","109Ag","107Ag","111Cd","119Sn","117Sn","115Sn","125Te","129Xe","169Tm","171Yb","183W","187Os","195Pt","199Hg","205Tl","203Tl","207Pb"],ATTR_PER_SITE=12,ALL_KEYS=["isotope","isotropic_chemical_shift","shielding_symmetric-zeta","shielding_symmetric-eta","shielding_symmetric-alpha","shielding_symmetric-beta","shielding_symmetric-gamma","quadrupolar-Cq","quadrupolar-eta","quadrupolar-alpha","quadrupolar-beta","quadrupolar-gamma"],ALL_KEY_UNITS=["","ppm","ppm","","rad","rad","rad","Hz","","rad","rad","rad"];window.spinSystem||(window.spinSystem={}),window.spinSystem={getIndex:function(){return storeData.spin_system_index},setIndex:function(index){storeData.spin_system_index=index},select:function(listomers,index){0<listomers.length&&listomers[index].click()}};var set_site_attributes=function(site){setValue("isotope",site.isotope),setValue("isotropic_chemical_shift",parseQuantityValue(site.isotropic_chemical_shift));let key="shielding_symmetric";if(site.hasOwnProperty(key)){let ss=site[key];setValue(`${key}-zeta`,parseQuantityValue(ss.zeta)),setValue(`${key}-eta`,ss.eta),setValue(`${key}-alpha`,ss.hasOwnProperty("alpha")?rad_to_deg(parseQuantityValue(ss.alpha)):null),setValue(`${key}-beta`,ss.hasOwnProperty("beta")?rad_to_deg(parseQuantityValue(ss.beta)):null),setValue(`${key}-gamma`,ss.hasOwnProperty("gamma")?rad_to_deg(parseQuantityValue(ss.gamma)):null),ss=null}else setValue(`${key}-zeta`,null),setValue(`${key}-eta`,null),setValue(`${key}-alpha`,null),setValue(`${key}-beta`,null),setValue(`${key}-gamma`,null);if(key="quadrupolar",site.hasOwnProperty(key)){let ss=site[key];setValue(`${key}-Cq`,parseQuantityValue(ss.Cq)/1e6),setValue(`${key}-eta`,ss.eta),setValue(`${key}-alpha`,ss.hasOwnProperty("alpha")?rad_to_deg(parseQuantityValue(ss.alpha)):null),setValue(`${key}-beta`,ss.hasOwnProperty("beta")?rad_to_deg(parseQuantityValue(ss.beta)):null),setValue(`${key}-gamma`,ss.hasOwnProperty("gamma")?rad_to_deg(parseQuantityValue(ss.gamma)):null),ss=null}else setValue(`${key}-Cq`,null),setValue(`${key}-eta`,null),setValue(`${key}-alpha`,null),setValue(`${key}-beta`,null),setValue(`${key}-gamma`,null);key=null},update_field_from_spin_system_at_index=function(site){var spin_system=storeData.data.spin_systems[site];let name=spin_system.name;setValue("spin-system-name",name),name=""==name?`Spin system ${site}`:name,document.getElementById("spin-system-title").innerHTML=name,setValue("spin-system-abundance",parseQuantityValue(spin_system.abundance));site=spin_system.sites[0];set_site_attributes(site),name=description=site=null},extract_site_object_from_fields=function(){var data=storeData.data;let update=!1,temp;if(null===data)throw window.dash_clientside.PreventUpdate;var index=window.spinSystem.getIndex();let spin_system=data.spin_systems[index];var old_site=spin_system.sites[0],old_site_string=JSON.stringify(old_site);temp=getValue("spin-system-name"),spin_system.name!=temp&&(spin_system.name=temp,update=!0),temp=getValue("spin-system-abundance"),temp=toQuantityValue(temp,"%"),spin_system.abundance!=temp&&(spin_system.abundance=temp,update=!0);let val,id,key,i,site={isotope:null,isotropic_chemical_shift:null,shielding_symmetric:{},quadrupolar:{}};for(i=0;i<ATTR_PER_SITE;i++)id=ALL_KEYS[i],val=getValue(id),null!=val&&(key=id.split("-"),"Cq"===key[1]?val*=1e6:0<=["alpha","beta","gamma"].indexOf(key[1])&&(val=deg_to_rad(val)),val=toQuantityValue(val,ALL_KEY_UNITS[i]),1===key.length&&(site[key[0]]=val),2===key.length&&(site[key[0]][key[1]]=val));if(0===Object.keys(site.shielding_symmetric).length&&delete site.shielding_symmetric,0===Object.keys(site.quadrupolar).length&&delete site.quadrupolar,old_site_string!==JSON.stringify(site)&&(update=!0),!update)throw window.dash_clientside.PreventUpdate;return spin_system.sites[0]=site,update=temp=null,val=id=key=i=site=null,spin_system},spinSystemOnClick=function(index){window.spinSystem.setIndex(index),update_field_from_spin_system_at_index(index),hideQuad();let overView=document.querySelectorAll("[data-table-sys] thead");overView.forEach(tr=>{tr.classList.remove("active")}),overView[index+1].classList.add("active")},activateSystemTools=function(){const obj=document.querySelectorAll("[data-table-header-sys] li");obj.forEach((li,i)=>{li.addEventListener("click",()=>{0==i&&document.getElementById("add-spin-system-button").click(),1==i&&document.getElementById("duplicate-spin-system-button").click(),2==i&&document.getElementById("remove-spin-system-button").click()})})},updateSystem=function(){let result={};return result.data=extract_site_object_from_fields(),result.index=window.spinSystem.getIndex(),result.operation="modify",result},addSystem=function(l){let result={};return result.data={name:`System ${l}`,description:"",abundance:"100 %",sites:[{isotope:"1H",isotropic_chemical_shift:"0 ppm"}]},result.index=l,result.operation="add",result.time=Date.now(),l=null,result},copySystem=function(data,l){let result={};return checkForEmptyListBeforeOperation("copy","spin system",l),result.data=data.spin_systems[window.spinSystem.getIndex()],result.index=l,result.operation="duplicate",data=l=null,result},delSystem=function(l){let result={};checkForEmptyListBeforeOperation("delete","spin system",l);var new_val=window.spinSystem.getIndex();return result.data=Date.now(),result.index=new_val,result.operation="delete",l=null,result},_updateSpinSystemJson=function(){var trig_id=ctxTriggerID()[0].split(".")[0].split("-")[0],data=storeData.data,l=data.spin_systems.length;return"apply"===trig_id?updateSystem():"add"===trig_id?addSystem(l):"duplicate"===trig_id?copySystem(data,l):"remove"===trig_id?delSystem(l):null},_searchSpinSystems=function(input){let filter,li,i,j,elements1,elements2,elements,txtValue;for(filter=input.toUpperCase(),li=document.querySelectorAll("#spin-system-read-only div.scrollable-list ul li"),i=0;i<li.length;i++)for(elements1=li[i].getElementsByTagName("div"),elements2=li[i].getElementsByTagName("b"),elements=[...elements1,...elements2],j=0;j<elements.length;j++){if(txtValue=elements[j].textContent||elements[j].innerText,-1<txtValue.toUpperCase().indexOf(filter)){li[i].style.display="";break}li[i].style.display="none"}throw filter=li=i=j=elements1=elements2=elements=txtValue=null,window.dash_clientside.PreventUpdate},_onSpinSystemsLoad=function(){var listomers=document.querySelectorAll("#spin-system-read-only div.scrollable-list ul li");activatePencilButton(document.querySelectorAll("[data-edit-sys]"),"view-spin_systems"),activateHomeTableElements(document.querySelectorAll("[data-table-sys] thead"),listomers),toggleClassNamesForSmallerScreens(document.getElementById("iso-slide"),listomers.length),updateListEventListener(listomers,spinSystemOnClick);let index=window.spinSystem.getIndex();return index=index>=listomers.length?0:index,window.spinSystem.select(listomers,index),null};window.dash_clientside.spin_system={searchSpinSystems:_searchSpinSystems,updateSpinSystemJson:_updateSpinSystemJson,onSpinSystemsLoad:_onSpinSystemsLoad};const TO_DEG=57.29577951307855;var setValue=function(id,val){document.getElementById(id).value=val},parseQuantityValue=function(val){return val=null==val?val:val.split(" ")[0],isNaN(+val)?val:+val},getValue=function(element){element=document.getElementById(element);if(0==element.validity.valid)throw alert("Invalid value encounter."),window.dash_clientside.PreventUpdate;let val=element.value;return""===val.trim()?null:isNaN(+val)?val:+val},toQuantityValue=function(val,unit){return null===val?null:val.toString().concat(` ${unit}`).trim()};function rad_to_deg(angle){return Math.round(1e10*(angle*TO_DEG+Number.EPSILON))/1e10}function deg_to_rad(angle){return angle/TO_DEG}function checkArrayEquality(a,b){if(a.length!==b.length)return!1;for(var len=a.length,i=0;i<len;i++)if(a[i]!==b[i])return!1;return!0}function checkObjectEquality(obj1,obj2){return JSON.stringify(obj1)===JSON.stringify(obj2)}function activateHomeTableElements(selectors,list){selectors.forEach((tr,i)=>{tr.addEventListener("click",()=>{list[i-1].click()})})}function activatePencilButton(selectors,target){selectors.forEach(edit=>{edit.addEventListener("click",()=>{document.getElementById(target).click()})})}function toggleClassNamesForSmallerScreens(element,length){element.classList.contains("slide-offset")&&(element.classList.toggle("slide-offset"),element.classList.toggle("slide")),0===length&&(element.classList.toggle("slide-offset"),element.classList.toggle("slide"))}function updateListEventListener(list,fn){list.forEach((tr,i)=>{document.removeEventListener("click",tr),tr.addEventListener("click",event=>{list.forEach(tri=>{tri.classList.remove("active")}),tr.classList.toggle("active"),fn(i),event.preventDefault(),scrollTo(tr.parentElement.parentElement,tr.offsetTop-200,300,"vertical")})})}
