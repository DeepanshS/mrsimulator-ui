const ISOTOPE_DATA=["1H","3He","13C","15N","19F","29Si","31P","57Fe","77Se","89Y","103Rh","109Ag","107Ag","111Cd","119Sn","117Sn","115Sn","125Te","129Xe","169Tm","171Yb","183W","187Os","195Pt","199Hg","205Tl","203Tl","207Pb"],ATTR_PER_SITE=12,ALL_KEYS=["isotope","isotropic_chemical_shift","shielding_symmetric-zeta","shielding_symmetric-eta","shielding_symmetric-alpha","shielding_symmetric-beta","shielding_symmetric-gamma","quadrupolar-Cq","quadrupolar-eta","quadrupolar-alpha","quadrupolar-beta","quadrupolar-gamma"],ALL_KEY_UNITS=["","ppm","ppm","","rad","rad","rad","Hz","","rad","rad","rad"];window.spinSystem||(window.spinSystem={}),window.spinSystem={getIndex:function(){return storeData.spin_system_index},setIndex:function(e){storeData.spin_system_index=e},select:function(e,t){0<e.length&&e[t].click()}};var set_site_attributes=function(t){setValue("isotope",t.isotope),setValue("isotropic_chemical_shift",parseQuantityValue(t.isotropic_chemical_shift));let a="shielding_symmetric";if(t.hasOwnProperty(a)){let e=t[a];setValue(`${a}-zeta`,parseQuantityValue(e.zeta)),setValue(`${a}-eta`,e.eta),setValue(`${a}-alpha`,e.hasOwnProperty("alpha")?rad_to_deg(parseQuantityValue(e.alpha)):null),setValue(`${a}-beta`,e.hasOwnProperty("beta")?rad_to_deg(parseQuantityValue(e.beta)):null),setValue(`${a}-gamma`,e.hasOwnProperty("gamma")?rad_to_deg(parseQuantityValue(e.gamma)):null),e=null}else setValue(`${a}-zeta`,null),setValue(`${a}-eta`,null),setValue(`${a}-alpha`,null),setValue(`${a}-beta`,null),setValue(`${a}-gamma`,null);if(a="quadrupolar",t.hasOwnProperty(a)){let e=t[a];setValue(`${a}-Cq`,parseQuantityValue(e.Cq)/1e6),setValue(`${a}-eta`,e.eta),setValue(`${a}-alpha`,e.hasOwnProperty("alpha")?rad_to_deg(parseQuantityValue(e.alpha)):null),setValue(`${a}-beta`,e.hasOwnProperty("beta")?rad_to_deg(parseQuantityValue(e.beta)):null),setValue(`${a}-gamma`,e.hasOwnProperty("gamma")?rad_to_deg(parseQuantityValue(e.gamma)):null),e=null}else setValue(`${a}-Cq`,null),setValue(`${a}-eta`,null),setValue(`${a}-alpha`,null),setValue(`${a}-beta`,null),setValue(`${a}-gamma`,null);a=null},update_field_from_spin_system_at_index=function(e){var t=storeData.data.spin_systems[e];let a=t.name;setValue("spin-system-name",a),a=""==a?`Spin system ${e}`:a,document.getElementById("spin-system-title").innerHTML=a,setValue("spin-system-abundance",parseQuantityValue(t.abundance));e=t.sites[0];set_site_attributes(e),a=description=e=null},extract_site_object_from_fields=function(){var e=storeData.data;let t=!1,a;if(null===e)throw window.dash_clientside.PreventUpdate;var s=window.spinSystem.getIndex();let n=e.spin_systems[s];var l=n.sites[0],i=JSON.stringify(l);a=getValue("spin-system-name"),n.name!=a&&(n.name=a,t=!0),a=getValue("spin-system-abundance"),a=toQuantityValue(a,"%"),n.abundance!=a&&(n.abundance=a,t=!0);let d,r,u,o,m={isotope:null,isotropic_chemical_shift:null,shielding_symmetric:{},quadrupolar:{}};for(o=0;o<ATTR_PER_SITE;o++)r=ALL_KEYS[o],d=getValue(r),null!=d&&(u=r.split("-"),"Cq"===u[1]?d*=1e6:0<=["alpha","beta","gamma"].indexOf(u[1])&&(d=deg_to_rad(d)),d=toQuantityValue(d,ALL_KEY_UNITS[o]),1===u.length&&(m[u[0]]=d),2===u.length&&(m[u[0]][u[1]]=d));if(0===Object.keys(m.shielding_symmetric).length&&delete m.shielding_symmetric,0===Object.keys(m.quadrupolar).length&&delete m.quadrupolar,i!==JSON.stringify(m)&&(t=!0),!t)throw window.dash_clientside.PreventUpdate;return n.sites[0]=m,t=a=null,d=r=u=o=m=null,n},spinSystemOnClick=function(e){window.spinSystem.setIndex(e),update_field_from_spin_system_at_index(e),hideQuad();let t=document.querySelectorAll("[data-table-sys] thead");t.forEach(e=>{e.classList.remove("active")}),t[e+1].classList.add("active")},activateSystemTools=function(){const e=document.querySelectorAll("[data-table-header-sys] li");e.forEach((e,t)=>{e.addEventListener("click",()=>{0==t&&document.getElementById("add-spin-system-button").click(),1==t&&document.getElementById("duplicate-spin-system-button").click(),2==t&&document.getElementById("remove-spin-system-button").click()})})},updateSystem=function(){let e={};return e.data=extract_site_object_from_fields(),e.index=window.spinSystem.getIndex(),e.operation="modify",e},addSystem=function(e){let t={};return t.data={name:`System ${e}`,description:"",abundance:"100 %",sites:[{isotope:"1H",isotropic_chemical_shift:"0 ppm"}]},t.index=e,t.operation="add",t.time=Date.now(),e=null,t},copySystem=function(e,t){let a={};return checkForEmptyListBeforeOperation("copy","spin system",t),a.data=e.spin_systems[window.spinSystem.getIndex()],a.index=t,a.operation="duplicate",e=t=null,a},delSystem=function(e){let t={};checkForEmptyListBeforeOperation("delete","spin system",e);var a=window.spinSystem.getIndex();return t.data=Date.now(),t.index=a,t.operation="delete",e=null,t},_updateSpinSystemJson=function(){var e=ctxTriggerID()[0].split(".")[0].split("-")[0],t=storeData.data,a=t.spin_systems.length;return"apply"===e?updateSystem():"add"===e?addSystem(a):"duplicate"===e?copySystem(t,a):"remove"===e?delSystem(a):null},_searchSpinSystems=function(e){let t,a,s,n,l,i,d,r;for(t=e.toUpperCase(),a=document.querySelectorAll("#spin-system-read-only div.scrollable-list ul li"),s=0;s<a.length;s++)for(l=a[s].getElementsByTagName("div"),i=a[s].getElementsByTagName("b"),d=[...l,...i],n=0;n<d.length;n++){if(r=d[n].textContent||d[n].innerText,-1<r.toUpperCase().indexOf(t)){a[s].style.display="";break}a[s].style.display="none"}throw t=a=s=n=l=i=d=r=null,window.dash_clientside.PreventUpdate},_onSpinSystemsLoad=function(){var e=document.querySelectorAll("#spin-system-read-only div.scrollable-list ul li"),t=document.querySelectorAll("[data-edit-sys]");activatePencilButton(t,"view-spin_systems"),t=document.querySelectorAll("[data-table-sys] thead"),activateHomeTableElements(t,e);t=document.getElementById("iso-slide");toggleClassNamesForSmallerScreens(t,e.length),updateListEventListener(e,spinSystemOnClick);let a=window.spinSystem.getIndex();return a=a>=e.length?0:a,window.spinSystem.select(e,a),null};window.dash_clientside.spin_system={searchSpinSystems:_searchSpinSystems,updateSpinSystemJson:_updateSpinSystemJson,onSpinSystemsLoad:_onSpinSystemsLoad};
